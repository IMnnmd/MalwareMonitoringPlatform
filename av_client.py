import subprocess
import socket
import base64

HEADER = 6
FORMAT = 'utf-8'

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.bind(('0.0.0.0', 4433))

sock.listen(3)

print('Binded sock')

commands = 0

def receive_msg(con, addr):
    global commands
    msg_len = con.recv(HEADER).decode(FORMAT)
    if msg_len:
        msg = base64.b64decode(con.recv(int(msg_len))).decode('utf-8')
        print(f'Message is: {msg}')
        commands += 1
        return msg

flag = False
while True:
    con, addr = sock.accept()
    while con:
        res = receive_msg(con, addr)
        if res == 'QUIT':
            flag = True
        if flag:
            break
    if flag:
        break

    #kasper_th = subprocess.Popen()
    #eset_th = subprocess.Popen()
    #winav_th = subprocess.Popen()

