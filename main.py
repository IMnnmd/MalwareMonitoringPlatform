import socket
import time
import base64

#For future releases
#AV_list = {'AVP':'/?', 'ESET':'--help', 'WinAV':'-h'}

AV_list = {'AVP': 'SCAN;/i0',
           'ESET': '/no-quarantine;/adv-heur',
           'WinAV': '-Scan;-ScanType 3;-DisableRemediation;-File'}
results = []

HEADER = 4
FORMAT = 'utf-8'
PORT = 22825

av_machine_ip = '192.168.58.128'

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((av_machine_ip, 4433))

while True:
    print('Файл берется из общей папки с машиной. Введите его имя:')
    filename = input()

    if filename == 'QUIT':
        msg = 'QUIT'
        base64_msg = base64.b64encode(msg.encode(FORMAT))
        msg_len = len(base64_msg)
        sock.send(('{:<}'.format(msg_len, HEADER)).encode(FORMAT))
        time.sleep(0.05)
        sock.send(base64_msg)
        sock.close()
        break

    for av in AV_list:

        msg = f'{av};{AV_list[av]};{filename}.{av};{filename}'
        base64_msg = base64.b64encode(msg.encode(FORMAT))
        msg_len = len(base64_msg)
        print('{:<}'.format(msg_len, HEADER).encode(FORMAT))
        sock.send(('{:<}'.format(msg_len, HEADER)).encode(FORMAT))
        time.sleep(0.1)
        sock.send(base64_msg)
        response = sock.recv(HEADER).decode(FORMAT)
        print(response)

#msg = 'QUIT'
#base64_msg = base64.b64encode(msg.encode(FORMAT))
#msg_len = len(base64_msg)
#sock.send(('{:<}'.format(msg_len, HEADER)).encode(FORMAT))
#time.sleep(0.05)
#sock.send(base64_msg)

time.sleep(1)
print('Successfully sent')