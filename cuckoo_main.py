import socket
import base64
import time
import json

HEADER = 4
FORMAT = 'utf-8'

cuckoo_port = 4433
cuckoo_machine_ip = '192.168.58.129'

REPORT_PATH = 'D:\\машины\\Shared\\Reports\\'


def cuckoo_thread(filename, sock, report_handle):

    msg = f'{filename}'
    base64_msg = base64.b64encode(msg.encode(FORMAT))
    msg_len = len(base64_msg)
    sock.send(('{:<}'.format(msg_len, HEADER)).encode(FORMAT))
    time.sleep(0.1)
    sock.send(base64_msg)
    while True:
        response = sock.recv(HEADER).decode(FORMAT)
        if response:
            break
    if response == 'ER-2':
        print('[CUCKOO]: File not found error')
        return response
    else:
        time.sleep(3)
        with open(REPORT_PATH + filename + ".CUCKOO", "r") as report:
            report_handle[1] = json.loads(report.read())
          #  score = rep['info']['score']
           # target = rep['target']['file']
            #print(f'[CUCKOO]: Score is {score} out of 10.')
            #report_handle[1] = [score, target]
            #return report_handle[1]
        return "Next"
    sock.close()





