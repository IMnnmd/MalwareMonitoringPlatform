import socket
import base64
import time
from datetime import datetime

HEADER = 4
FORMAT = 'utf-8'

cuckoo_port = 4433
cuckoo_machine_ip = '192.168.58.129'

print('here')
sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((cuckoo_machine_ip, cuckoo_port))
print('there')


def cuckoo_thread(filename):
    print(sock)
    try:
        response = ''
        msg = f'{filename}'
        base64_msg = base64.b64encode(msg.encode(FORMAT))
        msg_len = len(base64_msg)
        sock.send(('{:<}'.format(msg_len, HEADER)).encode(FORMAT))
        time.sleep(0.1)
        sock.send(base64_msg)
        while True:
            response = sock.recv(HEADER).decode(FORMAT)
            if response:
                break
        if response == 'ER-2':
            print('File not found error')
            do_parse = False
            return 0
        return response
    except Exception:
        return 0

#def cuckoo_thread_exit():
